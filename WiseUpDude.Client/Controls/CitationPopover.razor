@using WiseUpDude.Model

@if (IsActive)
{
    <SmartPopover AutoCloseMs="5000">
        <ChildContent>
            <span class="perplexity-pill popover-dismiss me-1"
                  role="button"
                  tabindex="0"
                  @onclick="HandleClick">
                <span class="perplexity-pill-number">@(Index + 1)</span>
            </span>
        </ChildContent>
        <PopoverContent>
            <div class="popover-card citation-popover">
                <div class="px-popover-row">
                    <img src="https://cdn.syncfusion.com/common/images/favicon/favicon-32x32.png" alt="Favicon" class="px-popover-favicon" />
                    <span class="px-popover-source">Citation</span>
                </div>
                <div class="px-popover-title">@(Citation.Title ?? Citation.Url)</div>
                <div class="px-popover-description">@((string.IsNullOrWhiteSpace(Citation.Description) ? "No summary available for this source." : Citation.Description))</div>
            </div>
        </PopoverContent>
    </SmartPopover>
}
else
{
    <span class="perplexity-pill popover-dismiss me-1"
          role="button"
          tabindex="0"
          @onclick="HandleClick">
        <span class="perplexity-pill-number">@(Index + 1)</span>
    </span>
}

@code {
    [Parameter] public CitationMeta Citation { get; set; } = default!;
    [Parameter] public int Index { get; set; }
    [Parameter] public bool IsActive { get; set; }
    [Parameter] public EventCallback<int> OnToggle { get; set; }

    private async Task HandleClick()
    {
        await OnToggle.InvokeAsync(Index);
    }
}